!function(){!function(){var t=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;window.requestAnimationFrame=t}();var t=!1;var e="ontouchstart"in document.documentElement,n={ROCK:0,SUCTION:1},i=[n.SUCTION,n.SUCTION,n.SUCTION,n.SUCTION],o=document.getElementById("canvas"),l=o.getContext("2d"),d=300,a=e?450:500,h=500,u=a/2,r={x:d/2,y:a-5,width:30,height:35,speed:4,velX:0,velY:0,jumping:!1,jumpHold:null,jumpHoldTime:null,ghost:0,grounded:!1,dead:!1,score:0},m={x:0,y:100,width:120,height:57,started:null},s=[],g=.8,c=e?.13:.2,p=!1;o.width=d,o.height=h;var w=new Image;w.src="/css/img/squid.png",w.width=30,w.height=35;var y=new Image;y.src="/css/img/squidJump1.png",y.width=30,y.height=35;var v=new Image;v.src="/css/img/squidJump2.png",v.width=30,v.height=35;var f=new Image;f.src="/css/img/squidJump3.png",f.width=30,f.height=35;var D=new Image;D.src="/css/img/squidDead.png",D.width=30,D.height=35;var F=Math.floor(7*Math.random()),x=new Image;x.src="/css/img/splash"+F+".png",x.width=1560,x.height=57,x.className="splashImage";var B=0,j=["#F0ECDB","#F0F0DB","#ECF0DB","#E9F0DB","#E6F0DB","#E2F0DB","#DFF0DB","#DBF0DB","#DBF0DF","#DBF0E2","#DBF0E6","#DBF0E9","#DBF0EC","#DBF0F0","#DBECF0","#DBE9F0","#DBE6F0","#DBE2F0","#DBDFF0","#DBDBF0","#DFDBF0","#E2DBF0","#E6DBF0","#E9DBF0","#ECDBF0","#F0DBF0","#F0DBEC","#F0DBE9","#F0DBE6","#F0DBE2","#F0DBDF","#F0DBDB","#F0DFDB","#F0E2DB","#F0E6DB","#F0E9DB"],T=[];C(!0),C(!0),C(!0);var E=Date.now()-1,S=Date.now();function H(){var e=Date.now(),n=Math.floor(1e3/(e-E));E=e,t&&(l.font="12px SplatRegular",l.fillText(n+" fps",10,16))}const I=15;function C(t){var e=T.length?T[T.length-1].y-150*Math.random()-(t?100:0):a-100-(t?100:0),o=Math.random()*(d-30),l=100*Math.random()+30;if(T.length){var h=T[T.length-1].x,u=T[T.length-1].x+T[T.length-1].width;o<h&&o+l>u&&(o=o<150?20:200)}!t&&e>0&&(e=0);var r=T.length?T[T.length-1].count+1:1;0!==r&&r%20==0&&i.push(n.ROCK);var m=i[Math.floor(Math.random()*i.length)];T.push({x:o,y:e,width:l,height:5,count:r,type:m,isTopSolid:m!==n.SUCTION,isBottomSolid:m!==n.SUCTION,isLeftSolid:m!==n.SUCTION,isRightSolid:m!==n.SUCTION})}function b(){if(S=Date.now(),r.dead)return l.font="60px SplatRegular",l.fillText("Game Over",10,100,d-20),H(),B=r.score,document.getElementById("share").style.display="",void(document.getElementById("retry").style.display="");var i=!1,o=null,F=null;s.touch&&s.touch.length&&(i=!0,o=s.touch[0],F=s.touch[s.touch.length-1]),s[40]||s[32]||i&&"end"!==F.action&&!o.wasJumping?r.jumping||r.jumpHold||(r.jumpHold=Math.round(Date.now()/1),r.jumpHoldTime=null,t&&console.log("holding")):r.jumping||(null!==r.jumpHold&&null===r.jumpHoldTime?(t&&console.log("jumping"),r.jumping=!0,r.grounded=!1,r.jumpHoldTime=Math.round(Date.now()/1)-r.jumpHold,e?r.jumpHoldTime>1500?r.jumpHoldTime=800:r.jumpHoldTime<500?r.jumpHoldTime=400:r.jumpHoldTime=(r.jumpHoldTime-500)/1e3*400+400:r.jumpHoldTime>1e3?r.jumpHoldTime=1e3:r.jumpHoldTime<500&&(r.jumpHoldTime=500),r.jumpHoldTime=r.speed*(r.jumpHoldTime/(e?700:650)),r.jumpHold=null,r.y-=1,r.velY=-2*r.jumpHoldTime,m.started=S,m.x=r.x-45,m.x<0&&(m.x=d-Math.abs(m.x)),m.y=r.y-18):null===r.jumpHold&&null!==r.jumpHoldTime&&(t&&console.log("resetting"),r.jumpHoldTime=null)),(s[39]&&r.jumping||i&&r.jumping&&r.x+r.width/2-2<F.x-(window.innerWidth/2-d/2))&&(i&&s.touch.length>1&&"end"!==F.action&&(s.touch=[F]),i&&r.velX<0&&"end"!==F.action&&(r.velX=0),r.velX<r.speed&&r.velX++),(s[37]&&r.jumping||i&&r.jumping&&r.x+r.width/2+2>F.x-(window.innerWidth/2-d/2))&&(i&&s.touch.length>1&&"end"!==F.action&&(s.touch=[F]),i&&r.velX>0&&"end"!==F.action&&(r.velX=0),r.velX>-r.speed&&r.velX--),r.velX*=g,r.velY+=c,l.clearRect(0,0,d,h),e&&(l.fillStyle="gray",l.fillRect(0,a,d,h-a));var E=300/j.length,O=Math.floor(r.score/E)%j.length;l.fillStyle=j[O],l.fillRect(0,0,d,a),l.fillStyle="black",l.beginPath(),r.grounded=!1;var R,X,N=null;r.ghost&&(N={x:0,y:r.y,width:r.width+r.x-d,height:r.height});for(var k=0;k<T.length;k++){switch(T[k].type){case n.SUCTION:l.fillStyle="orange";break;case n.ROCK:default:l.fillStyle="black"}l.rect(T[k].x,T[k].y,T[k].width,T[k].height),l.fill(),l.beginPath();var q=M(r,T[k]),U=null;N&&(U=M(N,T[k])),"l"===q||"r"===q||"l"===U||"r"===U?r.velX=0:"b"===q||"b"===U?(r.grounded=!0,r.jumping=!1,r.y=T[k].y-r.height):"t"!==q&&"t"!==U||(r.velY*=-1)}r.grounded&&(r.velY=0),r.x+=r.velX,r.y+=r.velY,r.x<0?r.x=d+r.x:r.x>d&&(r.x=r.x-d),r.x<0&&r.x>-1*r.width?(r.ghost=1,r.x=d-Math.abs(r.x)):r.x>d-r.width&&r.x<d+r.width?r.ghost=1:r.ghost=0,i&&r.jumping&&(o.wasJumping=!0),r.y>=a-r.height&&(r.y=a-r.height,r.jumping=!1,i&&"end"===F.action&&(s.touch=null),p&&(r.dead=!0));for(k=0;k<T.length;k++)T[k].type===n.SUCTION&&!T[k].isTopSolid&&T[k].y>r.y+r.height&&(T[k].isTopSolid=!0);if(r.y<=u){p=!0;var Y=r.y-u;r.y=u;for(k=0;k<T.length;k++)T[k].y-=Y;T[0].y>a&&(T.shift(),C()),m.y-=Y}if(r.dead)R=D,X=D;else if(r.jumping)R=w,X=w;else if(r.jumpHold){var L=Math.round(Date.now()/1)-r.jumpHold;!e&&L>1e3||e&&L>1500?(R=f,X=f):L<500?(R=y,X=y):(R=v,X=v)}else R=w,X=w;if(r.jumping&&function(){if(m.started){var t=Math.floor((S-m.started)/I);if(t>11&&(m.started=null),l.drawImage(x,t*m.width,0,m.width,m.height,m.x,m.y,m.width,m.height),m.x>d-120){var e=m.width+m.x-d;l.drawImage(x,t*m.width+m.width-e,0,e,m.height,0,m.y,e,m.height)}}}(),l.drawImage(R,r.x,r.y,w.width,w.height),0!==r.ghost&&1===r.ghost){var A=r.width+r.x-d,J=A/w.width*100;l.drawImage(X,100-J,0,J,117,0,r.y,A,w.height)}p&&(l.fillStyle="#5555ff",l.fillRect(0,a-4,d,4)),H(),l.font="16px SplatRegular",l.fillStyle="black",l.fillText("Score: "+r.score.toString().padStart(4,"0"),d-100,20),requestAnimationFrame(b)}function M(t,e){var n=t.x+t.width/2-(e.x+e.width/2),i=t.y+t.height/2-(e.y+e.height/2),o=t.width/2+e.width/2,l=t.height/2+e.height/2,d=null;if(Math.abs(n)<o&&Math.abs(i)<l){var a=o-Math.abs(n),h=l-Math.abs(i);a>=h?i>0?e.isBottomSolid&&(d="t",t.y+=h):e.isTopSolid&&(d="b",t.y-=h,r.score<e.count&&(r.score=e.count)):n>0?e.isRightSolid&&(d="l",t.x+=a):e.isLeftSolid&&(d="r",t.x-=a)}return d}document.body.addEventListener("keydown",function(t){s[t.keyCode]=!0}),document.body.addEventListener("keyup",function(t){s[t.keyCode]=!1}),window.addEventListener("load",function(){b()}),o.addEventListener("touchstart",function(e){e.preventDefault(),t&&console.log("touchstart.");var n=e.changedTouches,i=n[0].clientX,o=n[0].clientY;s.touch=[{x:i,y:o,action:"start"}]},!1),o.addEventListener("touchmove",function(e){e.preventDefault(),t&&console.log("touchstart.");var n=e.changedTouches,i=n[0].clientX,o=n[0].clientY;s.touch.push({x:i,y:o,action:"move"})},!1),o.addEventListener("touchend",function(e){e.preventDefault(),t&&console.log("touchstart.");var n=e.changedTouches,i=n[0].clientX,o=n[0].clientY;s.touch.push({x:i,y:o,action:"end"})},!1),e&&(document.getElementById("mobileControls").style.display="",document.getElementById("desktopControls").style.display="none"),window.share=function(){var t="https://twitter.com/intent/tweet?text=I%20made%20it%20to%20"+B+"%20platforms%20on%20r/Splatoon%20Hop!%20%23rsplatoonhop%20%23Splatoon%20How%20high%20can%20you%20go?%20https%3A%2F%2Fminigame.rsplatoon.com%2F";window.open(t,"_blank")}}();
!function(){!function(){var e=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;window.requestAnimationFrame=e}();var e=!1;var t="ontouchstart"in document.documentElement,n={ROCK:0,SUCTION:1},o=[n.SUCTION,n.SUCTION,n.SUCTION,n.SUCTION],i=document.getElementById("canvas"),l=i.getContext("2d"),a=300,h=t?450:500,d=500,u=h/2,r={x:a/2,y:h-5,width:30,height:35,speed:4,velX:0,velY:0,jumping:!1,jumpHold:null,jumpHoldTime:null,ghost:0,grounded:!1,dead:!1,score:0},m={x:0,y:100,width:120,height:57,started:null},g=[],s=.8,c=t?.13:.2,p=!1;i.width=a,i.height=d;var w=new Image;w.src="/css/img/squid.png",w.width=30,w.height=35;var y=new Image;y.src="/css/img/squidJump1.png",y.width=30,y.height=35;var v=new Image;v.src="/css/img/squidJump2.png",v.width=30,v.height=35;var f=new Image;f.src="/css/img/squidJump3.png",f.width=30,f.height=35;var D=new Image;D.src="/css/img/squidDead.png",D.width=30,D.height=35;var F=Math.floor(7*Math.random()),x=new Image;x.src="/css/img/splash"+F+".png",x.width=1560,x.height=57,x.className="splashImage";var B=0,j=["#F0ECDB","#F0F0DB","#ECF0DB","#E9F0DB","#E6F0DB","#E2F0DB","#DFF0DB","#DBF0DB","#DBF0DF","#DBF0E2","#DBF0E6","#DBF0E9","#DBF0EC","#DBF0F0","#DBECF0","#DBE9F0","#DBE6F0","#DBE2F0","#DBDFF0","#DBDBF0","#DFDBF0","#E2DBF0","#E6DBF0","#E9DBF0","#ECDBF0","#F0DBF0","#F0DBEC","#F0DBE9","#F0DBE6","#F0DBE2","#F0DBDF","#F0DBDB","#F0DFDB","#F0E2DB","#F0E6DB","#F0E9DB"],E=[];C(!0),C(!0),C(!0);var T=Date.now()-1,H=Date.now();function I(){var t=Date.now(),n=Math.floor(1e3/(t-T));T=t,e&&(l.font="12px SplatRegular",l.fillText(n+" fps",10,16))}const S=15;function C(e){var t=E.length?E[E.length-1].y-150*Math.random()-(e?100:0):h-100-(e?100:0),i=Math.random()*(a-30),l=100*Math.random()+30;if(E.length){var d=E[E.length-1].x,u=E[E.length-1].x+E[E.length-1].width;i<d&&i+l>u&&(i=i<150?20:200)}!e&&t>0&&(t=0);var r=E.length?E[E.length-1].count+1:1;0!==r&&r%20==0&&o.push(n.ROCK);var m=o[Math.floor(Math.random()*o.length)];E.push({x:i,y:t,width:l,height:5,count:r,type:m})}function b(){if(H=Date.now(),r.dead)return l.font="60px SplatRegular",l.fillText("Game Over",10,100,a-20),I(),B=r.score,document.getElementById("share").style.display="",void(document.getElementById("retry").style.display="");var o=!1,i=null,F=null;g.touch&&g.touch.length&&(o=!0,i=g.touch[0],F=g.touch[g.touch.length-1]),g[40]||g[32]||o&&"end"!==F.action&&!i.wasJumping?r.jumping||r.jumpHold||(r.jumpHold=Math.round(Date.now()/1),r.jumpHoldTime=null,e&&console.log("holding")):r.jumping||(null!==r.jumpHold&&null===r.jumpHoldTime?(e&&console.log("jumping"),r.jumping=!0,r.grounded=!1,r.jumpHoldTime=Math.round(Date.now()/1)-r.jumpHold,t?r.jumpHoldTime>1500?r.jumpHoldTime=800:r.jumpHoldTime<500?r.jumpHoldTime=400:r.jumpHoldTime=(r.jumpHoldTime-500)/1e3*400+400:r.jumpHoldTime>1e3?r.jumpHoldTime=1e3:r.jumpHoldTime<500&&(r.jumpHoldTime=500),r.jumpHoldTime=r.speed*(r.jumpHoldTime/(t?700:650)),r.jumpHold=null,r.y-=1,r.velY=-2*r.jumpHoldTime,m.started=H,m.x=r.x-45,m.x<0&&(m.x=a-Math.abs(m.x)),m.y=r.y-18):null===r.jumpHold&&null!==r.jumpHoldTime&&(e&&console.log("resetting"),r.jumpHoldTime=null)),(g[39]&&r.jumping||o&&r.jumping&&r.x+r.width/2-2<F.x-(window.innerWidth/2-a/2))&&(o&&g.touch.length>1&&"end"!==F.action&&(g.touch=[F]),o&&r.velX<0&&"end"!==F.action&&(r.velX=0),r.velX<r.speed&&r.velX++),(g[37]&&r.jumping||o&&r.jumping&&r.x+r.width/2+2>F.x-(window.innerWidth/2-a/2))&&(o&&g.touch.length>1&&"end"!==F.action&&(g.touch=[F]),o&&r.velX>0&&"end"!==F.action&&(r.velX=0),r.velX>-r.speed&&r.velX--),r.velX*=s,r.velY+=c,l.clearRect(0,0,a,d),t&&(l.fillStyle="gray",l.fillRect(0,h,a,d-h));var T=300/j.length,X=Math.floor(r.score/T)%j.length;l.fillStyle=j[X],l.fillRect(0,0,a,h),l.fillStyle="black",l.beginPath(),r.grounded=!1;var O,R,k=null;r.ghost&&(k={x:0,y:r.y,width:r.width+r.x-a,height:r.height});for(var q=0;q<E.length;q++){switch(E[q].type){case n.SUCTION:l.fillStyle="orange";break;case n.ROCK:default:l.fillStyle="black"}l.rect(E[q].x,E[q].y,E[q].width,E[q].height),l.fill(),l.beginPath();var N=M(r,E[q]),U=null;k&&(U=M(k,E[q])),"l"===N||"r"===N||"l"===U||"r"===U?r.velX=0:"b"===N||"b"===U?(r.grounded=!0,r.jumping=!1,r.y=E[q].y-r.height):"t"!==N&&"t"!==U||(r.velY*=-1)}if(r.grounded&&(r.velY=0),r.x+=r.velX,r.y+=r.velY,r.x<0?r.x=a+r.x:r.x>a&&(r.x=r.x-a),r.x<0&&r.x>-1*r.width?(r.ghost=1,r.x=a-Math.abs(r.x)):r.x>a-r.width&&r.x<a+r.width?r.ghost=1:r.ghost=0,o&&r.jumping&&(i.wasJumping=!0),r.y>=h-r.height&&(r.y=h-r.height,r.jumping=!1,o&&"end"===F.action&&(g.touch=null),p&&(r.dead=!0)),r.y<=u){p=!0;var Y=r.y-u;r.y=u;for(q=0;q<E.length;q++)E[q].y-=Y;E[0].y>h&&(E.shift(),C()),m.y-=Y}if(r.dead)O=D,R=D;else if(r.jumping)O=w,R=w;else if(r.jumpHold){var A=Math.round(Date.now()/1)-r.jumpHold;!t&&A>1e3||t&&A>1500?(O=f,R=f):A<500?(O=y,R=y):(O=v,R=v)}else O=w,R=w;if(r.jumping&&function(){if(m.started){var e=Math.floor((H-m.started)/S);if(e>11&&(m.started=null),l.drawImage(x,e*m.width,0,m.width,m.height,m.x,m.y,m.width,m.height),m.x>a-120){var t=m.width+m.x-a;l.drawImage(x,e*m.width+m.width-t,0,t,m.height,0,m.y,t,m.height)}}}(),l.drawImage(O,r.x,r.y,w.width,w.height),0!==r.ghost&&1===r.ghost){var L=r.width+r.x-a,J=L/w.width*100;l.drawImage(R,100-J,0,J,117,0,r.y,L,w.height)}p&&(l.fillStyle="#5555ff",l.fillRect(0,h-4,a,4)),I(),l.font="16px SplatRegular",l.fillStyle="black",l.fillText("Score: "+r.score.toString().padStart(4,"0"),a-100,20),requestAnimationFrame(b)}function M(e,t){var o=e.x+e.width/2-(t.x+t.width/2),i=e.y+e.height/2-(t.y+t.height/2),l=e.width/2+t.width/2,a=e.height/2+t.height/2,h=null;if(Math.abs(o)<l&&Math.abs(i)<a){var d=l-Math.abs(o),u=a-Math.abs(i);d>=u?i>0?t.type!==n.SUCTION&&(h="t",e.y+=u):(h="b",e.y-=u,r.score<t.count&&(r.score=t.count)):o>0?t.type!==n.SUCTION&&(h="l",e.x+=d):t.type!==n.SUCTION&&(h="r",e.x-=d)}return h}document.body.addEventListener("keydown",function(e){g[e.keyCode]=!0}),document.body.addEventListener("keyup",function(e){g[e.keyCode]=!1}),window.addEventListener("load",function(){b()}),i.addEventListener("touchstart",function(t){t.preventDefault(),e&&console.log("touchstart.");var n=t.changedTouches,o=n[0].clientX,i=n[0].clientY;g.touch=[{x:o,y:i,action:"start"}]},!1),i.addEventListener("touchmove",function(t){t.preventDefault(),e&&console.log("touchstart.");var n=t.changedTouches,o=n[0].clientX,i=n[0].clientY;g.touch.push({x:o,y:i,action:"move"})},!1),i.addEventListener("touchend",function(t){t.preventDefault(),e&&console.log("touchstart.");var n=t.changedTouches,o=n[0].clientX,i=n[0].clientY;g.touch.push({x:o,y:i,action:"end"})},!1),t&&(document.getElementById("mobileControls").style.display="",document.getElementById("desktopControls").style.display="none"),window.share=function(){var e="https://twitter.com/intent/tweet?text=I%20made%20it%20to%20"+B+"%20platforms%20on%20r/Splatoon%20Hop!%20%23rsplatoonhop%20%23Splatoon%20How%20high%20can%20you%20go?%20https%3A%2F%2Fminigame.rsplatoon.com%2F";window.open(e,"_blank")}}();